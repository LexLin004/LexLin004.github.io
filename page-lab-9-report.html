<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Lab 5 Fast Robot - Shihming Lin</title>
        <link href="css/styles.css" rel="stylesheet" />
        <link rel="icon" type="image/x-icon" href="assets/img/project-cover/right_corner_icon.png" />
        <script data-search-pseudo-elements defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <div id="layoutDefault">
            <div id="layoutDefault_content">
                <main>
                    <!-- Navbar-->
                    <nav class="navbar navbar-marketing navbar-expand-lg bg-white navbar-light">
                        <div class="container px-5">
                            <a class="navbar-brand text-primary" href="index.html"><img class="img-fluid rounded-3" src="assets/img/project-cover/right_corner_icon.png" /></a>
                            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><i data-feather="menu"></i></button>
                            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                <ul class="navbar-nav ms-auto me-lg-5">
                                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                                    <li class="nav-item dropdown dropdown-xl no-caret">
                                        <a class="nav-link dropdown-toggle" id="navbarDropdownDemos" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Projects
                                            <i class="fas fa-chevron-right dropdown-arrow"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-end animated--fade-in-up me-lg-n25 me-xl-n15" aria-labelledby="navbarDropdownDemos">
                                            <div class="row g-0">
                                                <div class="col-lg-5 p-lg-3 bg-img-cover overlay overlay-primary overlay-70 d-none d-lg-block" style="background-image: url('assets/img/backgrounds/bg-dropdown-xl.jpg')">
                                                    <div class="d-flex h-100 w-100 align-items-center justify-content-center">
                                                        <div class="text-white text-center z-1">
                                                            <div class="mb-3">Will add a image of robots/embedded systems or other related projects</div>
                                                            <a class="btn btn-white btn-sm text-primary fw-500" href="index.html">Show details</a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-7 p-lg-5">
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <h6 class="dropdown-header text-primary">Web Applications</h6>
                                                            <a class="dropdown-item" href="http://course-enrollment-lsm.s3-website-us-west-2.amazonaws.com/">Course Registration Service</a>
                                                            <a class="dropdown-item" href="https://serene-refuge-47001.herokuapp.com/">Emaily: A Feedback-Collection App</a>
                                                            <a class="dropdown-item" href="#!">E-commerce</a>
                                                            <div class="dropdown-divider border-0"></div>
                                                            <h6 class="dropdown-header text-primary">Robots</h6>
                                                            <a class="dropdown-item" href="fast-robot-all-project-main-page.html">Fast Robot</a>
                                                            <a class="dropdown-item" href="#!">Design and Control of an Autonomous, <br> 4-Legged Construction Robot</a>
                                                            <a class="dropdown-item" href="https://drive.google.com/file/u/3/d/1nS1tiqPLQ61-NSE5_IbpiMUPlx14oYKk/view?usp=sharing">Low-cost Perception System <br> and Remote Management of <br> an Autonomous Wheelchair</a>
                                                            <a class="dropdown-item" href="https://github.com/LexLin004/RelaxU">RelaxU: A Portable And Wearable Massager Tape <br> For Pain Relief and Muscle Recovery</a>
                                                            <div class="dropdown-divider border-0"></div>
                                                            <h6 class="dropdown-header text-primary">FPGA</h6>
                                                            <a class="dropdown-item" href="https://vanhunteradams.com/DE1/Lorenz/Lorenz.html">Hardware ODE solver with HPS control</a>
                                                            <a class="dropdown-item" href="https://vanhunteradams.com/DE1/Mandelbrot/Mandelbrot.html">Mandelbrot Set Visualizer</a>
                                                            <a class="dropdown-item" href="https://vanhunteradams.com/DE1/Drum/Drum_synthesis.html">Multiprocessor Drum Synthesis</a>
                                                            <div class="dropdown-divider border-0 d-lg-none"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="nav-item dropdown dropdown-xl no-caret">
                                        <a class="nav-link dropdown-toggle" id="navbarDropdownPages" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Personal
                                            <i class="fas fa-chevron-right dropdown-arrow"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-end me-lg-n20 me-xl-n15 animated--fade-in-up" aria-labelledby="navbarDropdownPages">
                                            <div class="row g-0">
                                                <div class="col-lg-4 p-lg-5">
                                                    <h6 class="dropdown-header text-primary">Education</h6>
                                                    <a class="dropdown-item" href="#!">One</a>
                                                    <a class="dropdown-item" href="#!">Two</a>
                                                    <div class="dropdown-divider border-0"></div>
                                                    <h6 class="dropdown-header text-primary">Engineering Experience</h6>
                                                    <a class="dropdown-item" href="#!">One</a>
                                                    <a class="dropdown-item" href="#!">Two</a>
                                                    <a class="dropdown-item" href="#!">Three</a>
                                                    <div class="dropdown-divider border-0 d-lg-none"></div>
                                                </div>
                                                <div class="col-lg-4 p-lg-5">
                                                    <h6 class="dropdown-header text-primary">Blogs</h6>
                                                    <a class="dropdown-item" href="page-blog-overview.html">Overview</a>
                                                    <a class="dropdown-item" href="page-blog-post.html">Post</a>
                                                    <a class="dropdown-item" href="page-blog-archive.html">Archive</a>
                                                    <div class="dropdown-divider border-0 d-lg-none"></div>
                                                </div>
                                                <div class="col-lg-4 p-lg-5">
                                                    <h6 class="dropdown-header text-primary">Other Design</h6>
                                                    <a class="dropdown-item" href="#!">1</a>
                                                    <a class="dropdown-item" href="#!">2</a>
                                                    <a class="dropdown-item" href="#!">3</a>
                                                    <a class="dropdown-item" href="#!">4</a>
                                                    <a class="dropdown-item" href="#!">5</a>
                                                    <div class="dropdown-divider border-0 d-lg-none"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="nav-item dropdown no-caret">
                                        <a class="nav-link dropdown-toggle" id="navbarDropdownDocs" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Documentation
                                            <i class="fas fa-chevron-right dropdown-arrow"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-end animated--fade-in-up" aria-labelledby="navbarDropdownDocs">
                                            <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-ui-kit-pro/quickstart" target="_blank">
                                                <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="book-open"></i></div>
                                                <div>
                                                    <div class="small text-gray-500">Documentation</div>
                                                    Usage instructions and reference
                                                </div>
                                            </a>
                                            <div class="dropdown-divider m-0"></div>
                                            <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-ui-kit-pro/components" target="_blank">
                                                <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="code"></i></div>
                                                <div>
                                                    <div class="small text-gray-500">Components</div>
                                                    Code snippets and reference
                                                </div>
                                            </a>
                                            <div class="dropdown-divider m-0"></div>
                                            <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-ui-kit-pro/changelog" target="_blank">
                                                <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="file-text"></i></div>
                                                <div>
                                                    <div class="small text-gray-500">Changelog</div>
                                                    Updates and changes
                                                </div>
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                                <a class="btn fw-500 ms-lg-4 btn-primary" href="fast-robot-all-project-main-page.html">
                                    Back
                                    <i class="ms-2" data-feather="arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </nav>
                    <section class="bg-light py-10">
                        <div class="container px-5">
                            <div class="row gx-5 justify-content-center">
                                <div class="col-lg-10 col-xl-8">
                                    <div class="single-post">
                                        <h1>Lab 9 report (Mapping)</h1>
                                        <p class="lead">In this <a href="https://fastrobotscornell.github.io/FastRobots/labs/Lab9.html">lab </a>,
                                            In this lab, I use a fully assembled robot to rotate at specific maker positions 
                                            by using orientation-based PID control and collect two tof data from the robot to map a static room.
                                        <div class="d-flex align-items-center justify-content-between mb-5">
                                            <div class="single-post-meta me-4">
                                                <img class="single-post-meta-img" src="assets/img/project-cover/right_corner_icon.png" />
                                                <div class="single-post-meta-details">
                                                    <div class="single-post-meta-details-name">Shihming Lin</div>
                                                    <div class="single-post-meta-details-date">Apr 16, 2024</div>
                                                </div>
                                            </div>
                                            <div class="single-post-meta-links">
                                                <a href="https://www.linkedin.com/in/shihming-lin-597008199"><i class="fab fa-linkedin fa-fw"></i></a>
                                                <a href="https://github.com/LexLin004"><i class="fab fa-github fa-fw"></i></a>
                                                <a href="https://github.com/robotconstruction"><i class="fab fa-github fa-fw"></i></a>
                                            </div>
                                        </div>
                                        <div class="single-post-text my-5">
                                            <h2>Control</h2>
                                            <p> 
                                                Because the tof would report an error output if it was taking a reading when its distance from the object varied too much,
                                                 I chose to use method two, Orientation control.
                                                 In this method, I used a PID controller to control the robot to rotate 10 degrees and then come to a standstill, 
                                                 then measured the data 10 times using sensors mounted on the front and left side of the robot, and repeated 36 times.
                                            </p>
                                            
                                            <h2>ToF Data Collection</h2>
                                            <p>
                                                The program controls the ToF sensor to collect data 10 times while the robot is stationary at an angle and stores them in an array as 
                                                struct 'DataPointTOF'. The 'dataPointTOF' contains the readings of tof1, the readings of tof2, the current angle, and the timestamp. 
                                                The final array will be sent to the computer via BLE. My python script then splits the received array into tof1 and tof2 based on the
                                                current angle, then remove the maximum and minimum values of each tof reading at the same angle and average the remaining values to 
                                                form the final array: [(tof1_average, tof2_average, current_yaw), ...]. The tof1 represents the reading of the tof mounted on the 
                                                left panel of the robot and the tof2 represents the reading of the tof mounted on the front panel of the robot. 
                                            </p>
                                            <h2>Code</h2>
                                            <p>
                                                I use two commands: set_pid_imu and rotate_a_circle. The set_pid_imu allows me to easily adjust the parameters of the pid controller,
                                                and the length of time for each rotation of 10 degrees to be performed. The rotate_a_circle controls the behavior of the robot as 
                                                it starts to rotate 36 times through 10 degrees and collects tof readings, and returns the collected tof data via Bluetooth.
                                            </p>
                                            <script src="https://gist.github.com/LexLin004/40815e1778463ea517c664ec997b0c90.js"></script>

                                            <h3>Continuous Rotate Demo</h3>
                                            <p>
                                                The following video demonstrates my implementation of controlling the car to rotate 360 degerees and to collect data using the above code.
                                            </p>
                                            <iframe width="560" height="315" src="https://youtube.com/embed/TXhIW0ocL3w"> </iframe>
                                            <p>Tof Data Demo</p>
                                            <script src="https://gist.github.com/LexLin004/561baacd6d2e5b1fe45f7ddfd518e72e.js"></script>

                                            <h2>Merge Data and Plot</h2>
                                            <p>Since I didn't have enough time to use the test environment in the lab, I set up the test environment shown below in another room, 
                                                along with a 3d model measured and built using a Bosch laser rangefinder as ground truth.</p>
                                            <img width=500 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/test_env.jpg" />
                                            <div class="small text-gray-500">Figure 1: Test environment</div>
                                            <img width=500 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/test_env_fusion360.jpg" />
                                            <div class="small text-gray-500">Figure 2: Test environment model</div>
                                            
                                            
                                            <p>The data plots collected through the method described in the ToF data colloection above are as follows, 
                                                figure 3 is the raw data and figure 4 is the averaged data.</p>
                                                <img width=500 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point1_raw.png" />
                                                <div class="small text-gray-500">Figure 3: polar corr. with raw data</div>
                                                <img width=500 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point1_avg.png" />
                                                <div class="small text-gray-500">Figure 4: polar corr. with averaged data</div>

                                            <p> 
                                                Since there is a distance between the tof sensors and the center/axis origin of the robot, 
                                                I need to use a homogeneous transformation matrix to process the data collected by the tof. 
                                                According to the measurements, tof2 (front tof) is 9 cm from the center of the robot, and 
                                                tof1 (left tof) is 4 cm from the center of the robot and is rotated 90 degrees counter-clockwise 
                                                by the z-axis of the robot's coordinate system.
                                                So I did following to each tof1 and tof2:
                                            </p>
                                            <script src="https://gist.github.com/LexLin004/fa7d14d86c8ea9525b311f75759ad7d5.js"></script>

                                            <p>With the transformed data, I plotted them on polar coordinates. The red x's are from tof2, the green x's are from tof1.</p>
                                            <img width=500 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point1_merge.png" />
                                            <div class="small text-gray-500">Figure 5: polar corr. with transformed data</div>
                                            
                                            <p>
                                                I controlled the robot to rotate again in the same position and the collected data was 
                                                displayed on the same plot in a different color.
                                            </p>
                                            <p>PLOT</p>
                                            <p>The next polar plots show data collected by controlling the robot to rotate at six designated points in a static room in the lab.</p>
                                            <img width=300 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point1_merge.png" />
                                            <div class="small text-gray-500">Figure 6: polar corr. with transformed data at position 1 (0,0)</div>
                                            
                                            <img width=300 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point2_merge.png" />
                                            <div class="small text-gray-500">Figure 7: polar corr. with transformed data at position 2 (0,0)</div>

                                            <img width=300 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point3_merge.png" />
                                            <div class="small text-gray-500">Figure 8: polar corr. with transformed data at position 3 (0,0)</div>

                                            <img width=300 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point4_merge.png" />
                                            <div class="small text-gray-500">Figure 9: polar corr. with transformed data at position 4 (0,0)</div>

                                            <img width=300 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point5_merge.png" />
                                            <div class="small text-gray-500">Figure 10: polar corr. with transformed data at position 5 (0,0)</div>

                                            <img width=300 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/point6_merge.png" />
                                            <div class="small text-gray-500">Figure 11: polar corr. with transformed data at position 6 (0,0)</div>


                                            <p>Since I know the coordinates and distances of the specified points, I converted the robot coordinate system to the world coordinate system and plot.</p>

                                            <img width=500 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/global_plot.png" />
                                            <div class="small text-gray-500">Figure 9: Data merged</div>

                                            <h2>Line-Based Map</h2>
                                            <p> 
                                                Based on the above plot, I drawn the following lines representing the obstacles and boundaries of the environment.
                                            </p>
                                            <img width=500 class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab9_assets/line_based_map.png" />
                                            <div class="small text-gray-500">Figure 10: Line-based map</div>
                                            <hr class="my-5" />
                                            <div class="text-center"><a class="btn btn-transparent-dark" href="fast-robot-all-project-main-page.html">Back to All Reports of Fast Robots Labs</a></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="svg-border-rounded text-dark">
                            <!-- Rounded SVG Border-->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144.54 17.34" preserveAspectRatio="none" fill="currentColor"><path d="M144.54,17.34H0V0H144.54ZM0,0S32.36,17.34,72.27,17.34,144.54,0,144.54,0"></path></svg>
                        </div>
                    </section>
                </main>
            </div>
<div id="layoutDefault_footer">
                <footer class="footer pt-10 pb-5 mt-auto bg-dark footer-dark">
                    <div class="container px-5">
                        <div class="row gx-5">
                            <div class="col-lg-3">
                                <div class="footer-brand">Shihming Lin</div>
                                <div class="mb-3">Portfolio</div>
                                <div class="icon-list-social mb-5">
                                    <a class="icon-list-social-link" href="#!"><i class="fab fa-instagram"></i></a>
                                    <a class="icon-list-social-link" href="#!"><i class="fab fa-facebook"></i></a>
                                    <a class="icon-list-social-link" href="#!"><i class="fab fa-github"></i></a>
                                    <a class="icon-list-social-link" href="#!"><i class="fab fa-twitter"></i></a>
                                </div>
                            </div>
                            <div class="col-lg-9">
                                <div class="row gx-5">
                                    <div class="col-lg-3 col-md-6 mb-5 mb-lg-0">
                                        <div class="text-uppercase-expanded text-xs mb-4">All Info</div>
                                        <ul class="list-unstyled mb-0">
                                            <li class="mb-2"><a href="#!">Projects</a></li>
                                            <li class="mb-2"><a href="#!">Personal</a></li>
                                            <li class="mb-2"><a href="#!">Documentation</a></li>
                                        </ul>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="text-uppercase-expanded text-xs mb-4">Legal</div>
                                        <ul class="list-unstyled mb-0">
                                            <li class="mb-2"><a href="#!">Privacy Policy</a></li>
                                            <li class="mb-2"><a href="#!">Terms and Conditions</a></li>
                                            <li><a href="#!">License</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="my-5" />
                        <div class="row gx-5 align-items-center">
                            <div class="col-md-6 small">Copyright &copy; LexLin004.github.io 2024</div>
                            <div class="col-md-6 text-md-end small">
                                <a href="#!">Privacy Policy</a>
                                &middot;
                                <a href="#!">Terms &amp; Conditions</a>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
    </body>
</html>
