<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Lab 2 Fast Robot - Shihming Lin</title>
        <link href="css/styles.css" rel="stylesheet" />
        <link rel="icon" type="image/x-icon" href="assets/img/project-cover/right_corner_icon.png" />
        <script data-search-pseudo-elements defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <div id="layoutDefault">
            <div id="layoutDefault_content">
                <main>
                    <!-- Navbar-->
                    <nav class="navbar navbar-marketing navbar-expand-lg bg-white navbar-light">
                        <div class="container px-5">
                            <a class="navbar-brand text-primary" href="index.html"><img class="img-fluid rounded-3" src="assets/img/project-cover/right_corner_icon.png" /></a>
                            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><i data-feather="menu"></i></button>
                            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                <ul class="navbar-nav ms-auto me-lg-5">
                                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                                    <li class="nav-item dropdown dropdown-xl no-caret">
                                        <a class="nav-link dropdown-toggle" id="navbarDropdownDemos" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Projects
                                            <i class="fas fa-chevron-right dropdown-arrow"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-end animated--fade-in-up me-lg-n25 me-xl-n15" aria-labelledby="navbarDropdownDemos">
                                            <div class="row g-0">
                                                <div class="col-lg-5 p-lg-3 bg-img-cover overlay overlay-primary overlay-70 d-none d-lg-block" style="background-image: url('assets/img/backgrounds/bg-dropdown-xl.jpg')">
                                                    <div class="d-flex h-100 w-100 align-items-center justify-content-center">
                                                        <div class="text-white text-center z-1">
                                                            <div class="mb-3">Will add a image of robots/embedded systems or other related projects</div>
                                                            <a class="btn btn-white btn-sm text-primary fw-500" href="index.html">Show details</a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-7 p-lg-5">
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <h6 class="dropdown-header text-primary">Web Applications</h6>
                                                            <a class="dropdown-item" href="http://course-enrollment-lsm.s3-website-us-west-2.amazonaws.com/">Course Registration Service</a>
                                                            <a class="dropdown-item" href="https://serene-refuge-47001.herokuapp.com/">Emaily: A Feedback-Collection App</a>
                                                            <a class="dropdown-item" href="#!">E-commerce</a>
                                                            <div class="dropdown-divider border-0"></div>
                                                            <h6 class="dropdown-header text-primary">Robots</h6>
                                                            <a class="dropdown-item" href="fast-robot-all-project-main-page.html">Fast Robot</a>
                                                            <a class="dropdown-item" href="#!">Design and Control of an Autonomous, <br> 4-Legged Construction Robot</a>
                                                            <a class="dropdown-item" href="https://drive.google.com/file/u/3/d/1nS1tiqPLQ61-NSE5_IbpiMUPlx14oYKk/view?usp=sharing">Low-cost Perception System <br> and Remote Management of <br> an Autonomous Wheelchair</a>
                                                            <a class="dropdown-item" href="https://github.com/LexLin004/RelaxU">RelaxU: A Portable And Wearable Massager Tape <br> For Pain Relief and Muscle Recovery</a>
                                                            <div class="dropdown-divider border-0"></div>
                                                            <h6 class="dropdown-header text-primary">FPGA</h6>
                                                            <a class="dropdown-item" href="https://vanhunteradams.com/DE1/Lorenz/Lorenz.html">Hardware ODE solver with HPS control</a>
                                                            <a class="dropdown-item" href="https://vanhunteradams.com/DE1/Mandelbrot/Mandelbrot.html">Mandelbrot Set Visualizer</a>
                                                            <a class="dropdown-item" href="https://vanhunteradams.com/DE1/Drum/Drum_synthesis.html">Multiprocessor Drum Synthesis</a>
                                                            <div class="dropdown-divider border-0 d-lg-none"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="nav-item dropdown dropdown-xl no-caret">
                                        <a class="nav-link dropdown-toggle" id="navbarDropdownPages" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Personal
                                            <i class="fas fa-chevron-right dropdown-arrow"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-end me-lg-n20 me-xl-n15 animated--fade-in-up" aria-labelledby="navbarDropdownPages">
                                            <div class="row g-0">
                                                <div class="col-lg-4 p-lg-5">
                                                    <h6 class="dropdown-header text-primary">Education</h6>
                                                    <a class="dropdown-item" href="#!">One</a>
                                                    <a class="dropdown-item" href="#!">Two</a>
                                                    <div class="dropdown-divider border-0"></div>
                                                    <h6 class="dropdown-header text-primary">Engineering Experience</h6>
                                                    <a class="dropdown-item" href="#!">One</a>
                                                    <a class="dropdown-item" href="#!">Two</a>
                                                    <a class="dropdown-item" href="#!">Three</a>
                                                    <div class="dropdown-divider border-0 d-lg-none"></div>
                                                </div>
                                                <div class="col-lg-4 p-lg-5">
                                                    <h6 class="dropdown-header text-primary">Blogs</h6>
                                                    <a class="dropdown-item" href="page-blog-overview.html">Overview</a>
                                                    <a class="dropdown-item" href="page-blog-post.html">Post</a>
                                                    <a class="dropdown-item" href="page-blog-archive.html">Archive</a>
                                                    <div class="dropdown-divider border-0 d-lg-none"></div>
                                                </div>
                                                <div class="col-lg-4 p-lg-5">
                                                    <h6 class="dropdown-header text-primary">Other Design</h6>
                                                    <a class="dropdown-item" href="#!">1</a>
                                                    <a class="dropdown-item" href="#!">2</a>
                                                    <a class="dropdown-item" href="#!">3</a>
                                                    <a class="dropdown-item" href="#!">4</a>
                                                    <a class="dropdown-item" href="#!">5</a>
                                                    <div class="dropdown-divider border-0 d-lg-none"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="nav-item dropdown no-caret">
                                        <a class="nav-link dropdown-toggle" id="navbarDropdownDocs" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Documentation
                                            <i class="fas fa-chevron-right dropdown-arrow"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-end animated--fade-in-up" aria-labelledby="navbarDropdownDocs">
                                            <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-ui-kit-pro/quickstart" target="_blank">
                                                <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="book-open"></i></div>
                                                <div>
                                                    <div class="small text-gray-500">Documentation</div>
                                                    Usage instructions and reference
                                                </div>
                                            </a>
                                            <div class="dropdown-divider m-0"></div>
                                            <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-ui-kit-pro/components" target="_blank">
                                                <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="code"></i></div>
                                                <div>
                                                    <div class="small text-gray-500">Components</div>
                                                    Code snippets and reference
                                                </div>
                                            </a>
                                            <div class="dropdown-divider m-0"></div>
                                            <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-ui-kit-pro/changelog" target="_blank">
                                                <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="file-text"></i></div>
                                                <div>
                                                    <div class="small text-gray-500">Changelog</div>
                                                    Updates and changes
                                                </div>
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                                <a class="btn fw-500 ms-lg-4 btn-primary" href="fast-robot-all-project-main-page.html">
                                    Back
                                    <i class="ms-2" data-feather="arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </nav>
                    <section class="bg-light py-10">
                        <div class="container px-5">
                            <div class="row gx-5 justify-content-center">
                                <div class="col-lg-10 col-xl-8">
                                    <div class="single-post">
                                        <h1>Lab 2 report (IMU)</h1>
                                        <p class="lead">In the <a href="https://fastrobotscornell.github.io/FastRobots/labs/Lab2.html">lab 2</a>,
                                            I connected the IMU ICM20948 to the Artemis board and recorded and analyzed data from the IMU.</p>
                                        <div class="d-flex align-items-center justify-content-between mb-5">
                                            <div class="single-post-meta me-4">
                                                <img class="single-post-meta-img" src="assets/img/project-cover/right_corner_icon.png" />
                                                <div class="single-post-meta-details">
                                                    <div class="single-post-meta-details-name">Shihming Lin</div>
                                                    <div class="single-post-meta-details-date">Feb 11, 2024</div>
                                                </div>
                                            </div>
                                            <div class="single-post-meta-links">
                                                <a href="https://www.linkedin.com/in/shihming-lin-597008199"><i class="fab fa-linkedin fa-fw"></i></a>
                                                <a href="https://github.com/LexLin004"><i class="fab fa-github fa-fw"></i></a>
                                                <a href="https://github.com/robotconstruction"><i class="fab fa-github fa-fw"></i></a>
                                            </div>
                                        </div>
                                        <div class="single-post-text my-5">
                                            <h2>Task 1: Set up the IMU</h2>
                                            <h3></h3>
                                            <p>I connected the IMU to my board's Qwiic connector.</p>
                                            <img width="300" class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/IMUconnect.png" />
                                            <div class="small text-gray-500">Figure 1: Picture of the Artemis IMU connections</div>
                                            <p>By installing the Arduino library 'SparkFun 9DOF IMU Breakout - ICM 20948', I can run the Example1_Basics.
                                                According to the Pimoromni, its I2C address can be 0x68/0x69(cut trace). The trace of the IMU I got is
                                                not cut, so the address should be 0x68. Since AD0_VAL defines as the value of the last bit of the I2C
                                                address, it should be 0 to makes it not be underflow.
                                            </p>
                                            <p> As shown in the video, the built-in LED blinks 3 times slowly on start-up to indicate the board is running. <br>
                                                <iframe width="600" height="300" src="https://www.youtube.com/embed/CJPBBmZaFRk?si=ZZBB5pi85TxSp3nF"> </iframe>
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/ICM20948direction.png" />
                                            <div class="small text-gray-500">Figure 2: Picture of the Artemis IMU direction</div>
                                            <p> When I rotate the board, the acceleration data changes mainly to show the direction of the gravity, as shown 
                                                in the above video and figure 3. As I rotate the IMU along the x-axis, the degree of acc_z gradually decreases 
                                                from +1g to 0g, while acc_y becomes +1g and acc_x stays the same. The gyroscope data changes to show the 
                                                rotational velocity. As I rotate faster, the value of gyro gets bigger and vice versa. <br>
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/IMU_x_rotate.png" />
                                            <div class="small text-gray-500">Figure 3: Rotate IMU along X-axis</div> <br>
                                            
                                            <p> When I flip the board, the value of the accelerometer reverse along the axis of rotation. As shown in figure 4, 
                                                when I flip the IMU along the x-axis, the degree of acc_z changes from +1g to -1g.
                                                The gyroscope shows rapid changes in angular rate. For example, the figure shows the rapid change in gyro_z.
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/IMU_x_flip.png" />
                                            <div class="small text-gray-500">Figure 4: Flip IMU along X-axis</div> <br>

                                            <p> When I accelerate along a certain axis, the accelerometer reading in that axis gets bigger. The gyroscope 
                                                reading doesn't change much because there is no rotating IMU. As shown in figure 5, I accelerate the IMU along
                                                 the '-x-axis' and the acc_x gets bigger, while the gyro value changes only slightly, 
                                                 probably due to vibration and noise.
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/IMU_x_move.png" />
                                            <div class="small text-gray-500">Figure 5: Move IMU along X-axis</div>
                                            
                                            <h2>Task 2: Accelerometer</h2>
                                            <h4>Convert to pitch and roll only from accelerometer data</h4>
                                            <p>By using the formula: 
                                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                                <mi>Pitch</mi><mo>=</mo>
                                                <mi mathvariant="normal">&#x3b8;</mi><mo>=</mo>
                                                <mi mathvariant="normal">a</mi><mi>t</mi><mi>a</mi><mi>n</mi><mn>2</mn>
                                                <mo>(</mo><msub><mi mathvariant="normal">a</mi><mi mathvariant="normal">y</mi></msub>
                                                <mo>,</mo><msub><mi mathvariant="normal">a</mi><mi mathvariant="normal">z</mi></msub><mo>)</mo>
                                                <mo>&#xd7;</mo><mfrac><mn>180</mn><mi mathvariant="normal">&#x3c0;</mi></mfrac>
                                                </math>
                                                 and 
                                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                                    <mi>Roll</mi><mo>=</mo>
                                                    <mi mathvariant="normal">&#x3d5;</mi><mo>=</mo>
                                                    <mi mathvariant="normal">a</mi><mi>t</mi><mi>a</mi><mi>n</mi><mn>2</mn>
                                                    <mo>(</mo><msub><mi mathvariant="normal">-a</mi><mi mathvariant="normal">x</mi></msub>
                                                    <mo>,</mo><msub><mi mathvariant="normal">a</mi><mi mathvariant="normal">z</mi></msub><mo>)</mo>
                                                    <mo>&#xd7;</mo><mfrac><mn>180</mn><mi mathvariant="normal">&#x3c0;</mi></mfrac>
                                                </math> 
                                                the pitch and roll can be calculated. As the lecture, I define the clockwise direction around the X-axis as the positive pitch direction;
                                                the clockwise direction around the Y-axis as the positive roll direction; 
                                                and the clockwise direction around the Z-axis as the positive yaw direction, as shown in Figure 2. 
                                                I placed the imu at -90,0,90 degrees along the pitch/roll direction, 
                                                recorded 996 data for each placement, plotted the following plots and calculated the mean and accuracy.
                                            </p>
                                            
                                            <p> As shown in the left plot in the figure 5, the pitch value at -90 degree are -86.76916.
                                                <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Accuracy</mi><mo>=</mo><mn>1</mn>
                                                        <mo>-</mo><mfenced open="|" close="|"><mfrac><mrow><mo>-</mo><mn>90</mn><mo>+</mo><mn>86.76915747241726</mn>
                                                        </mrow><mrow><mo>-</mo><mn>90</mn></mrow></mfrac></mfenced><mo>&#xd7;</mo><mn>100</mn><mo>%</mo>
                                                        <mo>=</mo><mn>96.41</mn><mo>%</mo>
                                                </math>
                                                <br><br>
                                                As shown in the middle plot in the figure 5, the pitch value at 0 degree are -0.00567.
                                                <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Absolute Error</mi><mo>=</mo><mo>|</mo><mn>0</mn><mo>-</mo>
                                                    <mn>0.005668001003009033</mn><mo>|</mo><mo>=</mo><mn>0.0057</mn>
                                                </math>
                                                <br><br>
                                                As shown in the right plot in the figure 5, the pitch value at +90 degree are 87.02103.
                                                <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Accuracy</mi><mo>=</mo><mn>1</mn><mo>-</mo><mfenced open="|" close="|">
                                                    <mfrac><mrow><mn>90</mn><mo>-</mo><mn>87.0210330992979</mn></mrow><mn>90</mn></mfrac></mfenced><mo>&#xd7;</mo><mn>100</mn>
                                                    <mo>%</mo><mo>=</mo><mn>96.69</mn><mo>%</mo>
                                                </math>
                                                <br><br>
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/pitch-90-90.png" />
                                            <div class="small text-gray-500">Figure 5: Place IMU along Pitch direction at {-90, 0, 90} degrees</div>
                                            <p>
                                                As shown in the left plot in the figure 6, the roll value at -90 degree are -87.15554. 
                                                <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Accuracy</mi><mo>=</mo><mn>1</mn><mo>-</mo><mfenced open="|" close="|">
                                                    <mfrac><mrow><mn>90</mn><mo>-</mo><mn>-87.1555421686747</mn></mrow><mn>90</mn></mfrac></mfenced><mo>&#xd7;</mo><mn>100</mn>
                                                    <mo>%</mo><mo>=</mo><mn>97.16</mn><mo>%</mo>
                                                </math>   
                                                <br><br>
                                                As shown in the middle plot in the figure 6, the roll value at 0 degree are -0.05848.
                                                <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Absolute Error</mi><mo>=</mo><mo>|</mo><mn>0</mn><mo>-</mo>
                                                    <mn>-0.058475426278836506</mn><mo>|</mo><mo>=</mo><mn>0.0585</mn>
                                                </math>    
                                                <br><br>
                                                As shown in the right plot in the figure 6, the roll value at +90 degree are 86.37310.
                                                <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Accuracy</mi><mo>=</mo><mn>1</mn><mo>-</mo><mfenced open="|" close="|">
                                                    <mfrac><mrow><mn>90</mn><mo>-</mo><mn>86.37309929789367</mn></mrow><mn>90</mn></mfrac></mfenced><mo>&#xd7;</mo><mn>100</mn>
                                                    <mo>%</mo><mo>=</mo><mn>96.37</mn><mo>%</mo>
                                                </math>
                                                <br><br>
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/roll-90-90.png" />
                                            <div class="small text-gray-500">Figure 6: Place IMU along roll direction at {-90, 0, 90} degrees</div>
                                            
                                            <p>The data and code for above calculation and plot is <a href="https://github.com/LexLin004/robotcode/tree/main/pitch_roll_a_data_code_plot">here</a>.
                                            </p>
                                            <p>
                                                I can use two-point calibration for pitch based on the points (-90, -86.76915747241726) and (90, 87.0210330992979). The result formula is 
                                                <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>pitch</mi><mo>=</mo><mn>1.03573164519733 *</mn><mi>pitch_old</mi><mo>-</mo><mn>0.130437778707076</mn><mrow/></math>.
                                            <br>                 
                                                For roll, the two points I used are (-90, -87.1555421686747) and (90, 86.37309929789367). The result formula is 
                                                <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>roll</mi><mo>=</mo><mn>1.03729274014214 *</mn><mi>roll_old</mi><mo>+</mo><mn>0.405811154718554</mn></math>.
                                            </p>
                                            <p> The following 6 plots in figure 7 show the pitch and roll value after two point calibration. The mean value of IMU's pitch and roll data are 
                                                more closed to the correct value.
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/IMU_pitchroll_a_aftercali.png" />
                                            <div class="small text-gray-500">Figure 7: Pitch and roll value after two point calibration</div>

                                            <h4>Fourier Transform & complementary low pass filter</h4>
                                            <p>
                                                I collected 996 accelerometer data without large noise around, the data in time domain and in frequency domain plot are shown in the 
                                                figure 8 and figure 9. Then, I collected 996 accelerometer data with large noise around(knock the table), the data in time domain and in frequency domain plot are shown in the 
                                                figure 10 and figure 11. As you can see in the figure 11, the cutoff frequency should be around 40Hz.
                                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                                    <mi>&#x3b1;</mi><mo>=</mo><mfrac><mi>T</mi><mrow><mi>T</mi><mo>+</mo><mi>RC</mi></mrow></mfrac><mo>=</mo>
                                                    <mfrac><mfrac><mn>1</mn><mrow><mi>sample_rate</mi></mrow></mfrac>
                                                    <mrow><mfrac><mn>1</mn><mrow><mi>sample_rate</mi></mrow></mfrac><mo>+</mo>
                                                    <mfrac><mn>1</mn><mrow><mn>2</mn><mi>&#x3c0;</mi><msub><mi>f</mi><mi>c</mi></msub>
                                                    </mrow></mfrac></mrow></mfrac><mo>=</mo><mfrac><mfrac><mn>1</mn><mn>153.9052268643466</mn>
                                                    </mfrac><mrow><mfrac><mn>1</mn><mn>153.9052268643466</mn></mfrac><mo>+</mo><mfrac><mn>1</mn>
                                                        <mrow><mn>2</mn><mi>&#x3c0;</mi><mo>&#xd7;</mo><mn>40</mn><mi>H</mi><mi>z</mi></mrow></mfrac></mrow></mfrac>
                                                        <mo>=</mo><mn>0.62021</mn>
                                                </math>
                                            </p>

                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/vibration_stationary_time.png" />
                                            <div class="small text-gray-500">Figure 8: Pitch and roll Time Domain Plot without vibrating the table</div>

                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/vibration_stationary_freq.png" />
                                            <div class="small text-gray-500">Figure 9: Pitch and roll Freq Domain Plot without vibrating the table</div>

                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/vibration_knock_time.png" />
                                            <div class="small text-gray-500">Figure 10: Pitch and roll Time Domain Plot with vibrating the table</div>

                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/vibration_knock_freq.png" />
                                            <div class="small text-gray-500">Figure 11: Pitch and roll Freq Domain Plot with vibrating the table</div>

                                            <p>However, after applying the low pass filter as following code, there's little change in pitch and roll in the frequency domain, as shown in figure 13.</p>
                                            <script src="https://gist.github.com/LexLin004/94a3121bcb34f809b1728eb33a76a2a0.js"></script>
                                            
                                            
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/vibration_knock_lp_time.png" />
                                            <div class="small text-gray-500">Figure 12: Pitch and roll Time Domain Plot with lowpass filter and vibrating the table</div>

                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/vibration_knock_lp_freq.png" />
                                            <div class="small text-gray-500">Figure 13: Pitch and roll Freq Domain Plot with lowpass filter and vibrating the table</div>
                                            <p>The code in python used to collect the serial data and analyze is shown in the following script.</p>
                                            <script src="https://gist.github.com/LexLin004/e888aeafcbe32e3ea28e1e5ed6ff056b.js"></script>

                                            <h4> Discussion on result </h4>
                                            <p>The reason the simple low-pass filter I wrote doesn't work is probably because there is a filter built into the chip, as shown in Figure 14. 
                                                This image can be found in the <a href="https://invensense.tdk.com/wp-content/uploads/2016/06/DS-000189-ICM-20948-v1.3.pdf"> ICM-20948 datasheet</a>. </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/builtin_lp_filter.png" />
                                            <div class="small text-gray-500">Figure 14: Built-in Low-pass Filter</div>

                                            <h2>Gyroscope</h2>
                                            <h4>Compute pitch, roll, and yaw from gyroscope data and complementary filter</h4>
                                            <p>
                                                By using the following code burned into the board, I can get the yaw_g, pitch_g, roll_g form the integration of gyroscope data.
                                                I also can get pitch, roll from complementary filter using gyroscope data and accelerometer data.
                                            </p>
                                            <script src="https://gist.github.com/LexLin004/53b7de67c1daa2ac8f8eea00fb000265.js"></script>
                                            <p>
                                                To show the accuracy and range of pitch_g calculated using only gyroscope data and pitch calculated using the complementary filter, 
                                                I rotated imu along the x-axis and showed their values at {-90,0,90} degrees, as seen in Figure 15. At the beginning (left plot), 
                                                pitch_g and pitch are overlapped, and at a stable 90 degrees, pitch_g = 85.72 and pitch = 86.5, the accuracy rate are 95.24% and 96.11%.
                                                However, due to the cumulative error caused by the integration, pitch_g is shifted more and more, which can be seen in the middle 
                                                and right plots, where the blue line and the red line are gradually separating from each other. 
                                                At a steady 0 degrees, pitch_g = -6.51 and pitch = 0.11, the absolute error are 6.51% and 0.11%.
                                                At a steady -90 degrees, pitch_g = -97.86 and pitch = -87.55, the accuracy rate are 91.27% and 97.28%.
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/Time_Domain_Signal_of_pitch_g,_roll_g,_yaw_g,_pitch,_roll_when_rotate_along_x.png" />
                                            <div class="small text-gray-500">Figure 15: Time Domain Signal of pitch_g, roll_g, yaw_g, pitch, roll when rotate along x</div>

                                            <p>
                                                To show the accuracy and range of roll_g calculated using only gyroscope data and roll calculated using the complementary filter, 
                                                I rotated imu along the y-axis and showed their values at {-90,0,90} degrees, as seen in Figure 16. 
                                                At a stable 90 degrees, roll_g = 105.72 and roll = 87.92, the accuracy rate are 72.53% and 97.69%.
                                                At a stable 0 degrees, roll_g = 16.06 and roll = 0.23, the absolute error are 16.06% and 0.23%.
                                                At a stable -90 degrees, roll_g = -72.26 and roll = -86.41, the accuracy rate are 80.29% and 96.01%.
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/Time_Domain_Signal_of_pitch_g,_roll_g,_yaw_g,_pitch,_roll_when_rotate_along_y.png" />
                                            <div class="small text-gray-500">Figure 16: Time Domain Signal of pitch_g, roll_g, yaw_g, pitch, roll when rotate along y</div>

                                            <p>
                                                To show the accuracy and range of yaw calculated using only gyroscope data, 
                                                I rotated imu along the z-axis and showed their values at {-90,0,90} degrees, as seen in Figure 17. 
                                                At a stable 90 degrees, roll_g = 107.6, the accuracy rate are 80.44%.
                                                At a stable 0 degrees, roll_g = 19.69, the absolute error are 19.69%.
                                                At a stable -90 degrees, roll_g = -69.3, the accuracy rate are 77.00%.
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/Time_Domain_Signal_of_pitch_g,_roll_g,_yaw_g,_pitch,_roll_when_rotate_along_z.png" />
                                            <div class="small text-gray-500">Figure 17: Time Domain Signal of pitch_g, roll_g, yaw_g, pitch, roll when rotate along z</div>

                                            <p>
                                                The pitch, roll, and yaw values from the integration of gyroscope data only are gradually shifted over time, even at rest, as seen in Figure 18.
                                                However, the pitch and roll from the complementary filter does not be affected. They are not susceptible to drift or quick vibrations.
                                            </p>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/Time_Domain_Signal_of_pitch_g,_roll_g,_yaw_g,_pitch,_roll at_original_position_for_30_seconds.png" />
                                            <div class="small text-gray-500">Figure 17: Time Domain Signal of pitch_g, roll_g, yaw_g, pitch, roll at original position for 30 seconds</div>


                                            <p>
                                                By using the following code, I changed the frequency from 83.33Hz to 20Hz. Then, I did the same operation of rotation to my IMU. As shwon in Figure 18,
                                                a lower frequency caused the drift be bigger, and the accuracy rate of pitch_g, roll_g, yaw_g, pitch, and roll be lower since the dy in the integral 
                                                becomes larger, and each sampling of gyro and acce values had a greater impact on the results.
                                            </p>
                                            <script src="https://gist.github.com/LexLin004/3f938bfc2107f475c84e6887b26a29d9.js"></script>
                                            <img class="img-fluid mb-2 rounded" src="assets/img/lab_assets/lab2_assets/Time_Domain_Signal_of_pitch_g,_roll_g,_yaw_g,_pitch,_roll_20Hz.png" />
                                            <div class="small text-gray-500">Figure 18: Time Domain Signal of pitch_g, roll_g, yaw_g, pitch, roll when frequency=20Hz</div>

                                            <p>
                                                As shown in the following video, the range of the complementary filter is -180 degrees to 180 degrees since when I rotate the IMU along x/y axis more than 180 degrees,
                                                the value will change to -180 degrees. This brings up some design considerations, as we need to avoid applying this filter to devices with large steering ranges, 
                                                or needing to do extra work on the formulas, or on the subsequent analysis of the data in this case.
                                            </p>
                                            <iframe width="560" height="315" src="https://www.youtube.com/embed/ckP9GlkPt_Y?si=Gsx2BHpY7eyFkLCK"></iframe>

                                            <h2>Sample Data</h2>
                                            <h4>Speed of sampling discussion</h4>
                                            <p> To speed up the execution of the main loop, I burned following code into board, I got following feedback:  <br>
                                                First DataPoint - timestamp: 81, floats[0]: -9.765625 <br>
                                                Last DataPoint - timestamp: 7417, floats[0]: -13.671875 <br>
                                                Time elapsed: 7336 <br>
                                                Data recorded: 3000 <br>
                                                Frequency: 408.94 <br>
                                                NOT READY TIMES: 42 <br>
                                                The spped of the new way used to sample data is 408.94Hz.
                                                The main loop on the Artemis runs faster than the IMU produces new values since in the main loop, the times of myICM.dataReady() is false is 42.
                                                </p>
                                                <script src="https://gist.github.com/LexLin004/7233e2b7c9a7e56dfac4dd552a35b4d6.js"></script>
                                            <h4>Collect and store time-stamped IMU data in arrays</h4>
                                            <p> As shown in the above code, the size of the array 'dataPoints' stored the IMU data is the flag being used to stop the operation of store new IMU data.
                                                In the array used to store IMU data, each element in it is 9 floats and 1 unsigned int string, including 9 imu data and 1 time stamp. I choose to use
                                                this struct to stroe data to increase the sampling rate.
                                                Since the memory of the Artemis is 384KB, and I uses struct of 40 bytes = 4bytes * 9 floats + 4bytes*1 unsigned long. If the sampling
                                                rate is 408.94Hz, the Artemis can store 384 * 1024 / 40 / 408.94 = 24.04 seconds.
                                                <br> Then, I combined 1 IMU data (9 floats + 1 unsigned long) to be a string in csv format, and send to computer via BLE. Related codes are shown following.
                                            </p>
                                            <script src="https://gist.github.com/LexLin004/7233e2b7c9a7e56dfac4dd552a35b4d6.js"></script>
                                            
                                            <h4>Discussion</h4>
                                            <p>I use a large struct array to store the accelerometer and gyroscope data to get the highest sampling rate. I chose to use this way to store the data
                                                 because most IMU data is of the floating point type, this structure makes reading the data easy to understand, and it uses the least amount of memory. 
                                                 When sending the data to the computer, I reconstructed the data into a string consisting of 9 IMU data + 1 timestamp. This way, it is sent data 
                                                 faster than if all the floating point type data was sent individually.
                                            </p>    
                                            <script src="https://gist.github.com/LexLin004/b7e1960c29bd1d31ed374739e598ba09.js"></script>
                                            <script src="https://gist.github.com/LexLin004/26b756ac373413a0f8595f9ce4d7e5b3.js"></script>
                                            <script src="https://gist.github.com/LexLin004/acfa159a127c89ba2f70a79d53a2538a.js"></script>
                                            <h4>Collection and send via BLE</h4>
                                            <p>The following video shows the board collects 5s IMU data and sends to the computer via BLE.</p>
                                            <iframe width="560" height="315" src="https://www.youtube.com/embed/dCqwjQjZ9aw?si=yZblm4M1XwX10Kv0"></iframe>
                                            <h2>Record a stunt</h2>
                                            <p> This is the video of playing the car without Artemis.  Currently, since I don't have the Artemis connected to a battery, the Artemis is not able
                                                 to run and collect IMU data without being connected to a computer.
                                            <iframe width="560" height="315" src="https://www.youtube.com/embed/W0xcvWsZJm0?si=Xc65RB6t2OQTPn-p"></iframe>
                                            <hr class="my-5" />
                                            <div class="text-center"><a class="btn btn-transparent-dark" href="fast-robot-all-project-main-page.html">Back to All Reports of Fast Robots Labs</a></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="svg-border-rounded text-dark">
                            <!-- Rounded SVG Border-->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144.54 17.34" preserveAspectRatio="none" fill="currentColor"><path d="M144.54,17.34H0V0H144.54ZM0,0S32.36,17.34,72.27,17.34,144.54,0,144.54,0"></path></svg>
                        </div>
                    </section>
                </main>
            </div>
<div id="layoutDefault_footer">
                <footer class="footer pt-10 pb-5 mt-auto bg-dark footer-dark">
                    <div class="container px-5">
                        <div class="row gx-5">
                            <div class="col-lg-3">
                                <div class="footer-brand">Shihming Lin</div>
                                <div class="mb-3">Portfolio</div>
                                <div class="icon-list-social mb-5">
                                    <a class="icon-list-social-link" href="#!"><i class="fab fa-instagram"></i></a>
                                    <a class="icon-list-social-link" href="#!"><i class="fab fa-facebook"></i></a>
                                    <a class="icon-list-social-link" href="#!"><i class="fab fa-github"></i></a>
                                    <a class="icon-list-social-link" href="#!"><i class="fab fa-twitter"></i></a>
                                </div>
                            </div>
                            <div class="col-lg-9">
                                <div class="row gx-5">
                                    <div class="col-lg-3 col-md-6 mb-5 mb-lg-0">
                                        <div class="text-uppercase-expanded text-xs mb-4">All Info</div>
                                        <ul class="list-unstyled mb-0">
                                            <li class="mb-2"><a href="#!">Projects</a></li>
                                            <li class="mb-2"><a href="#!">Personal</a></li>
                                            <li class="mb-2"><a href="#!">Documentation</a></li>
                                        </ul>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="text-uppercase-expanded text-xs mb-4">Legal</div>
                                        <ul class="list-unstyled mb-0">
                                            <li class="mb-2"><a href="#!">Privacy Policy</a></li>
                                            <li class="mb-2"><a href="#!">Terms and Conditions</a></li>
                                            <li><a href="#!">License</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="my-5" />
                        <div class="row gx-5 align-items-center">
                            <div class="col-md-6 small">Copyright &copy; LexLin004.github.io 2024</div>
                            <div class="col-md-6 text-md-end small">
                                <a href="#!">Privacy Policy</a>
                                &middot;
                                <a href="#!">Terms &amp; Conditions</a>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
    </body>
</html>
